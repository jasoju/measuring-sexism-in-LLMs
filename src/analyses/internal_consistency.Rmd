---
title: "Reliability & convergent validty"
author: "Jana Jung"
date: "15 1 2025"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/jana/PycharmProjects/Master_Thesis/src")
```



```{r packages message=FALSE}
# load packages
library(tidyverse)
library(haven)
library(psych)
library(sirt)
library(glue)
```



```{r}
# load ASI data
file_ASI <- "wide__Mistral-7B-Instruct-v0.3__persona_hub__ASI__2025-01-04_02-54"

# wide__dolphin-2.8-mistral-7b-v02__chatbot_arena_conv__ASI__2025-01-08_22-59
# wide__dolphin-2.8-mistral-7b-v02__persona_hub__ASI__2025-01-21_01-02
# wide__Mistral-7B-Instruct-v0.3__chatbot_arena_conv__ASI__2024-12-30_19-25
# wide__Mistral-7B-Instruct-v0.3__persona_hub__ASI__2025-01-04_02-54

index <- "persona_id" # question_id / persona_id
dir_ASI <- glue("output_data/wide/{file_ASI}.csv")

ASI <- read.csv(dir_ASI, header=TRUE, row.names=index)
```


```{r}
# load MSS data
file_MSS <- "wide__Mistral-7B-Instruct-v0.3__persona_hub__MSS__2025-01-18_06-51"

# wide__dolphin-2.8-mistral-7b-v02__chatbot_arena_conv__MSS__2025-01-10_22-50
# wide__dolphin-2.8-mistral-7b-v02__persona_hub__MSS__2025-01-10_20-49
# wide__Mistral-7B-Instruct-v0.3__chatbot_arena_conv__MSS__2025-01-18_01-28
# wide__Mistral-7B-Instruct-v0.3__persona_hub__MSS__2025-01-18_06-51

dir_MSS <- glue("output_data/wide/{file_MSS}.csv")

MSS <- read.csv(dir_MSS, header=TRUE, row.names=index) # uses same index as ASI
```


```{r}
# only select columns with variance > 0 (needed for omega calculation)
ASI_filtered <- ASI[, apply(ASI, 2, var) > 0]
MSS_filtered <- MSS[, apply(MSS, 2, var) > 0]

```


# Internal consistency

## ASI

### Cronbach's alpha (stratified)

```{r}
# define item strata
itemstrata <- rbind(c("X1","B"),
                    c("X2","H"),
                    c("X3","B"),
                    c("X4","H"),
                    c("X5","H"),
                    c("X6","B"),
                    c("X7","H"),
                    c("X8","B"),
                    c("X9","B"),
                    c("X10","H"),
                    c("X11","H"),
                    c("X12","B"),
                    c("X13","B"),
                    c("X14","H"),
                    c("X15","H"),
                    c("X16","H"),
                    c("X17","B"),
                    c("X18","H"),
                    c("X19","B"),
                    c("X20","B"),
                    c("X21","H"),
                    c("X22","B")
                    )

stratified.cronbach.alpha(ASI, itemstrata = itemstrata)
```


### McDonald's omega

```{r}
omega(ASI_filtered, flip = FALSE)
```

## MSS

### Cronbach's alpha

```{r}
alpha(MSS)
```


### McDonald's omega

```{r}
omega(MSS_filtered, flip = FALSE)
```




# Convergent validity

```{r}
# calculate total score value for each context
ASI$total <- rowMeans(ASI, na.rm = TRUE)
MSS$total <- rowMeans(MSS, na.rm = TRUE)

```

```{r}
# calculate correlation (pearson)
cor(ASI$total, MSS$total)


```




